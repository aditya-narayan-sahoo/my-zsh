# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ Arch Linux System Utilities â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

# â”€â”€â”€ Command Availability Check â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
is_installed() {
  command -v "$1" >/dev/null 2>&1
}

# â”€â”€â”€ Spinner Function â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
spinner() {
  local pid=$1 delay=0.1 spinstr='|/-\'
  while kill -0 $pid 2>/dev/null; do
    for ((i=0; i<${#spinstr}; i++)); do
      echo -ne "${spinstr:i:1}  \r"
      sleep $delay
    done
  done
  echo -ne "   \r"
}

# â”€â”€â”€ Drop Memory Caches â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
drop-caches() {
  echo "ğŸ’¡ Dropping memory caches..."
  sync && sudo sh -c 'echo 3 > /proc/sys/vm/drop_caches'
}

# â”€â”€â”€ System Update â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
upgrade() {
  echo "ğŸ”„ Updating system packages..."
  local start=$(date +%s)

  sudo pacman -Syu && echo "âœ… System updated via pacman." || echo "âŒ Pacman update failed."

  if is_installed yay; then
    echo "ğŸ”„ Updating AUR packages..."
    yay -Syu && echo "âœ… AUR packages updated." || echo "âŒ AUR update failed."
  fi

  if is_installed flatpak; then
    echo "ğŸ”„ Updating Flatpak packages..."
    flatpak update -y && echo "âœ… Flatpak updated." || echo "âŒ Flatpak update failed."
  fi

  local end=$(date +%s)
  echo "â±ï¸ Total time: $((end - start)) seconds."
}

# â”€â”€â”€ India Mirrorlist + Upgrade â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
mirrup() {
  echo "ğŸŒ Backing up mirrorlist..."
  sudo cp /etc/pacman.d/mirrorlist "/etc/pacman.d/mirrorlist.backup.$(date +%Y%m%d_%H%M%S)"

  echo "ğŸŒ Updating mirrorlist (India)..."
  if sudo reflector --country India --protocol https --sort rate --save /etc/pacman.d/mirrorlist; then
    echo "âœ… Mirrorlist updated."
    upgrade
    echo "ğŸ“‹ Current mirrorlist:"
    echo "-------------------------------------------------"
    cat /etc/pacman.d/mirrorlist
    echo "-------------------------------------------------"
  else
    echo "âŒ Reflector failed."
  fi
}

# â”€â”€â”€ Global Mirrorlist + Upgrade â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
update-all() {
  local tmpfile=$(mktemp)
  sudo true || return 1

  if rate-mirrors --protocol https --save="$tmpfile" arch --max-delay=21600; then
    head -n 4 "$tmpfile" >"$tmpfile.head"
    grep -v '^#' "$tmpfile" | sed '1,4d' >>"$tmpfile.head"
    sudo mv /etc/pacman.d/mirrorlist /etc/pacman.d/mirrorlist-backup
    sudo mv "$tmpfile.head" /etc/pacman.d/mirrorlist
    drop-caches
    echo "ğŸ”„ Updating system with new mirrors..."
    upgrade
  else
    echo "âŒ rate-mirrors failed."
  fi

  rm -f "$tmpfile" "$tmpfile.head"
}

# â”€â”€â”€ Cache Cleaner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
cclean() {
  local force=false docker=false npm=false

  for arg in "$@"; do
    case $arg in
      --force|-f) force=true ;;
      --docker) docker=true ;;
      --npm) npm=true ;;
    esac
  done

  echo "ğŸ§¹ Cleaning pacman cache..."
  sudo pacman -Sc --noconfirm

  if $force || read -q "REPLY?ğŸ—‘ï¸ Delete all cached pacman packages? (y/N): "; then
    sudo pacman -Scc --noconfirm
    sudo rm -rf /var/cache/pacman/pkg/*
    echo "âœ… Full pacman cache cleaned."
  else
    echo "â­ï¸ Skipped full pacman cache clean."
  fi

  if is_installed yay; then
    echo "ğŸ§¹ Cleaning yay cache..."
    yay -Sc --noconfirm
    if $force || read -q "REPLY?ğŸ—‘ï¸ Delete all cached yay packages? (y/N): "; then
      yay -Scc --noconfirm
    else
      echo "â­ï¸ Skipped full yay cache clean."
    fi
  fi

  if is_installed flatpak; then
    echo "ğŸ§¹ Cleaning unused Flatpak runtimes..."
    flatpak uninstall --unused -y
  fi

  echo "ğŸ§¾ Vacuuming journal logs > 7 days..."
  sudo journalctl --vacuum-time=7d

  if $docker && is_installed docker && systemctl is-active --quiet docker; then
    echo "ğŸ³ Cleaning Docker..."
    docker system prune -af --volumes
  fi

  if $npm && is_installed npm && [[ -d "$HOME/.npm" ]]; then
    echo "ğŸ“¦ Cleaning npm cache..."
    npm cache clean --force
  fi

  echo "âœ… Cleanup complete."
}

# â”€â”€â”€ Git Add, Commit, Push â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
gac() {
  [[ -z "$1" ]] && { echo "âŒ Commit message required."; return 1; }

  git rev-parse --git-dir >/dev/null 2>&1 || { echo "âŒ Not a Git repo."; return 1; }

  echo "ğŸ“‚ Staging changes..."
  git add .

  echo "ğŸ“ Committing: $*"
  git commit -m "$*" || { echo "âš ï¸ Commit failed."; return 1; }

  local branch=$(git rev-parse --abbrev-ref HEAD)
  echo "ğŸš€ Pushing to '$branch'..."
  git push origin "$branch" && echo "âœ… Pushed." || echo "âŒ Push failed."
}

# Optional auto-completion for gac
_gac() {
  compadd -- "Your commit message here"
}
compdef _gac gac

gcom() {
	git add .
	git commit -m "$1"
}

# â”€â”€â”€ System Health Report â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
syshealth() {
  echo "ğŸ–¥ï¸ System Health Report"

  echo -n "ğŸ§  CPU: "
  top -bn1 | awk '/Cpu/ {print $2 + $4 "%"}'

  echo -n "ğŸ’¾ RAM: "
  free -h | awk '/^Mem:/ {print $3 " used / " $2 " total"}'

  echo -n "ğŸ’½ Disk (/): "
  df -h / | awk 'NR==2 {print $3 " used / " $2 " total (" $5 " used)"}'

  if is_installed sensors; then
    echo "ğŸŒ¡ï¸ Temperature:"
    sensors | grep -E 'temp[1-9]_input|Core'
  else
    echo "âš ï¸ Install 'lm_sensors' for temp info."
  fi

  echo "ğŸ”§ Services (docker, sshd):"
  for svc in docker sshd; do
    systemctl is-active --quiet "$svc" && echo " âœ” $svc running" || echo " âŒ $svc not running"
  done
}

# â”€â”€â”€ End of Arch Linux System Utilities â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
